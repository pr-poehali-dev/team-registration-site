# ü§ñ Telegram –±–æ—Ç –¥–ª—è —Ç—É—Ä–Ω–∏—Ä–∞

–ë–æ—Ç –¥–ª—è –ø—Ä–∏—ë–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π –∫–æ–º–∞–Ω–¥, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∫–∞–ø–∏—Ç–∞–Ω–æ–≤ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–æ–º.

## üìÅ –§–∞–π–ª—ã –≤ –ø–∞–ø–∫–µ

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `bot.py` | –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ –±–æ—Ç–∞ (PostgreSQL) |
| `bot-mysql.py` | –í–µ—Ä—Å–∏—è –¥–ª—è MySQL/MariaDB |
| `requirements.txt` | –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è PostgreSQL |
| `requirements-mysql.txt` | –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è MySQL |
| `.env.example` | –ü—Ä–∏–º–µ—Ä –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–ª—è PostgreSQL |
| `.env.mysql.example` | –ü—Ä–∏–º–µ—Ä –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–ª—è MySQL |
| `SETUP.md` | –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ (PostgreSQL) |
| `SETUP-MYSQL.md` | –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ (MySQL) |
| `start.sh` | –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞ |

## üéØ –í—ã–±–æ—Ä –≤–µ—Ä—Å–∏–∏

### –ò—Å–ø–æ–ª—å–∑—É–π `bot.py` (PostgreSQL) –µ—Å–ª–∏:
- ‚úÖ –£ —Ç–µ–±—è –æ—Ç–¥–µ–ª—å–Ω–∞—è PostgreSQL –±–∞–∑–∞
- ‚úÖ –ë–æ—Ç –∏ –±–∞–∑–∞ –Ω–∞ –æ–¥–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ
- ‚úÖ –ù—É–∂–Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ò—Å–ø–æ–ª—å–∑—É–π `bot-mysql.py` (MySQL) –µ—Å–ª–∏:
- ‚úÖ –ë–∞–∑–∞ –Ω–∞ Timeweb —Ö–æ—Å—Ç–∏–Ω–≥–µ (MySQL)
- ‚úÖ –ë–æ—Ç –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–º VPS
- ‚úÖ –£–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å MySQL

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –í–∞—Ä–∏–∞–Ω—Ç 1: PostgreSQL
```bash
# –°–ª–µ–¥—É–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
cat SETUP.md
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: MySQL (Timeweb)
```bash
# –°–ª–µ–¥—É–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
cat SETUP-MYSQL.md
```

## üîß –§—É–Ω–∫—Ü–∏–∏ –±–æ—Ç–∞

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
- `/start` - –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –ø–æ–º–æ—â—å
- `/register` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥—ã (–ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Å–∞–π—Ç)
- `/myteam` - –ü–æ–∫–∞–∑–∞—Ç—å —Å–≤–æ—é –∫–æ–º–∞–Ω–¥—É
- `/help` - –°–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥

### API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:

#### `POST /webhook`
–ü—Ä–∏—ë–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –æ—Ç Telegram

#### `POST /notify-captain`
–û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫–∞–ø–∏—Ç–∞–Ω—É
```json
{
  "captain_telegram": "username",
  "message": "–í–∞—à–∞ –∫–æ–º–∞–Ω–¥–∞ –æ–¥–æ–±—Ä–µ–Ω–∞!"
}
```

#### `GET /health`
–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
```json
{"status": "ok", "bot": "running"}
```

#### `GET /setup-webhook`
–ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhook (–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ)

## üìä –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

–ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–∞–±–ª–∏—Ü—É `telegram_users`:

```sql
CREATE TABLE telegram_users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(255) UNIQUE NOT NULL,
    chat_id BIGINT NOT NULL,
    first_name VARCHAR(255),
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏ —Å –±–æ—Ç–æ–º.

## üîê –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### PostgreSQL –≤–µ—Ä—Å–∏—è:
```env
TELEGRAM_BOT_TOKEN=your_token
DATABASE_URL=postgresql://user:pass@localhost/db
WEBHOOK_URL=https://your-domain.ru
```

### MySQL –≤–µ—Ä—Å–∏—è:
```env
TELEGRAM_BOT_TOKEN=your_token
DB_HOST=localhost
DB_USER=username
DB_PASSWORD=password
DB_NAME=database
WEBHOOK_URL=https://your-domain.ru
```

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∫–∞–∫ systemd —Å–µ—Ä–≤–∏—Å):
```bash
journalctl -u tournament-bot -f
```

## üõ† –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

–õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip3 install -r requirements.txt

# –°–æ–∑–¥–∞–π .env
cp .env.example .env
# –ó–∞–ø–æ–ª–Ω–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

# –ó–∞–ø—É—Å—Ç–∏
python3 bot.py
```

–ë–æ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ `http://localhost:5000`

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è webhook –∏—Å–ø–æ–ª—å–∑—É–π ngrok:
```bash
ngrok http 5000
# –£–∫–∞–∂–∏ URL –æ—Ç ngrok –≤ WEBHOOK_URL
```

## üìñ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å PHP backend

–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ `telegram_users`.

PHP –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ API:
```php
$url = 'https://bot.yourdomain.ru/notify-captain';
$data = [
    'captain_telegram' => 'username',
    'message' => '–í–∞—à–∞ –∫–æ–º–∞–Ω–¥–∞ –æ–¥–æ–±—Ä–µ–Ω–∞!'
];

$ch = curl_init($url);
curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($data));
curl_setopt($ch, CURLOPT_HTTPHEADER, ['Content-Type: application/json']);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
$result = curl_exec($ch);
curl_close($ch);
```

## ‚öôÔ∏è Systemd —Å–µ—Ä–≤–∏—Å

–ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ —Å–±–æ—è—Ö:
```bash
systemctl enable tournament-bot
systemctl start tournament-bot
systemctl status tournament-bot
```

## üîç –û—Ç–ª–∞–¥–∫–∞

–ü—Ä–æ–≤–µ—Ä–∫–∞ webhook:
```bash
curl https://api.telegram.org/bot<YOUR_TOKEN>/getWebhookInfo
```

–î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å:
```json
{
  "ok": true,
  "result": {
    "url": "https://your-domain.ru/webhook",
    "has_custom_certificate": false,
    "pending_update_count": 0
  }
}
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö –ø—Ä–æ–≤–µ—Ä—å:
1. ‚úÖ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω: `systemctl status tournament-bot`
2. ‚úÖ Webhook –Ω–∞—Å—Ç—Ä–æ–µ–Ω: `/setup-webhook`
3. ‚úÖ –ë–∞–∑–∞ –¥–æ—Å—Ç—É–ø–Ω–∞: –ø—Ä–æ–≤–µ—Ä—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
4. ‚úÖ SSL —Ä–∞–±–æ—Ç–∞–µ—Ç: `https://your-domain.ru/health`
5. ‚úÖ –õ–æ–≥–∏: `journalctl -u tournament-bot -n 50`

## üöÄ –ì–æ—Ç–æ–≤–æ!

–ë–æ—Ç –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ –∏ –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –°–æ—Ö—Ä–∞–Ω—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∫–æ–Ω—Ç–∞–∫—Ç–µ
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–º–∞–Ω–¥–∞—Ö
- –ü—Ä–∏–Ω–∏–º–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ API
- –†–∞–±–æ—Ç–∞—Ç—å 24/7 —Å –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–º
